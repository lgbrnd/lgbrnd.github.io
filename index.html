<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Geometric Brownian Motion (GBM) Demo</title>
  <!-- Include Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }

    #controls {
      margin-bottom: 20px;
    }

    .control {
      margin: 10px 0;
    }

    label {
      display: inline-block;
      width: 120px;
    }

    #chart {
      width: 90%;
      max-width: 900px;
      margin: auto;
    }

    /* Make sliders more visible on some browsers */
    input[type=range] {
      width: 300px;
    }
  </style>
</head>
<body>

<h1>Geometric Brownian Motion (GBM) Paths</h1>
<p>This page simulates multiple GBM paths that all start at the same price. You can adjust parameters below.</p>

<div id="controls">
  <!-- Number of GBMs -->
  <div class="control">
    <label for="pathsSlider">Number of GBMs</label>
    <input type="range" id="pathsSlider" min="1" max="200" value="10" />
    <span id="pathsValue">10</span>
  </div>

  <!-- Drift (mu) -->
  <div class="control">
    <label for="driftSlider">Drift (μ)</label>
    <input type="range" id="driftSlider" min="-0.2" max="0.2" step="0.01" value="0.05" />
    <span id="driftValue">0.05</span>
  </div>

  <!-- Volatility (sigma) -->
  <div class="control">
    <label for="volSlider">Volatility (σ)</label>
    <input type="range" id="volSlider" min="0.0" max="0.5" step="0.01" value="0.2" />
    <span id="volValue">0.20</span>
  </div>

  <!-- Toggle log scale -->
  <div class="control">
    <button id="toggleScaleBtn">Use Log Scale</button>
  </div>
</div>

<div id="chart"></div>

<script>
/*
  Generate multiple Geometric Brownian Motion paths.

  S_{t+1} = S_t * exp( (mu - 0.5*sigma^2)*dt + sigma * sqrt(dt) * Z )
  where Z ~ N(0,1).
*/

// Default parameters
let S0        = 100;   // Initial stock price
let T         = 1;     // Total time in years
let steps     = 252;   // Number of time steps (e.g. trading days in a year)
let dt        = T / steps;
let numPaths  = 10;
let mu        = 0.05;
let sigma     = 0.2;
let yScale    = 'linear'; // or 'log'

// Elements
const pathsSlider   = document.getElementById('pathsSlider');
const pathsValue    = document.getElementById('pathsValue');
const driftSlider   = document.getElementById('driftSlider');
const driftValue    = document.getElementById('driftValue');
const volSlider     = document.getElementById('volSlider');
const volValue      = document.getElementById('volValue');
const toggleScaleBtn= document.getElementById('toggleScaleBtn');

// Update displayed slider values
pathsValue.textContent = pathsSlider.value;
driftValue.textContent = driftSlider.value;
volValue.textContent   = volSlider.value;

/**
 * Simulate `count` GBM paths.
 */
function simulateGBM(count, mu, sigma) {
  let data = [];
  for (let i = 0; i < count; i++) {
    let S = S0;
    let traceX = [];
    let traceY = [];

    for (let stepIndex = 0; stepIndex <= steps; stepIndex++) {
      traceX.push(stepIndex);
      traceY.push(S);
      // Next step
      let Z = gaussianRandom(); // standard normal
      S = S * Math.exp((mu - 0.5 * sigma * sigma) * dt + sigma * Math.sqrt(dt) * Z);
    }

    data.push({
      x: traceX,
      y: traceY,
      mode: 'lines',
      line: { width: 1 },
      name: 'Path ' + (i + 1),
      showlegend: false
    });
  }
  return data;
}

/**
 * Plot or re-plot the chart.
 */
function plotGBM() {
  numPaths = Number(pathsSlider.value);
  mu       = Number(driftSlider.value);
  sigma    = Number(volSlider.value);

  let traces = simulateGBM(numPaths, mu, sigma);

  let layout = {
    title: 'Geometric Brownian Motion Paths',
    xaxis: {
      title: 'Time Step'
    },
    yaxis: {
      title: 'Price',
      type: yScale
    }
  };

  Plotly.newPlot('chart', traces, layout);
}

/**
 * Toggle scale between linear and log.
 */
function toggleScale() {
  yScale = (yScale === 'linear') ? 'log' : 'linear';
  toggleScaleBtn.textContent = (yScale === 'linear') 
    ? 'Use Log Scale'
    : 'Use Linear Scale';
  plotGBM();
}

/**
 * Returns a random number ~ N(0,1).
 */
function gaussianRandom() {
  // Using the Box-Muller transform
  let u = 0, v = 0;
  while (u === 0) u = Math.random(); // Converting [0,1) to (0,1)
  while (v === 0) v = Math.random();
  return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

// Event listeners for sliders
pathsSlider.addEventListener('input', function() {
  pathsValue.textContent = pathsSlider.value;
  plotGBM();
});

driftSlider.addEventListener('input', function() {
  driftValue.textContent = driftSlider.value;
  plotGBM();
});

volSlider.addEventListener('input', function() {
  volValue.textContent = volSlider.value;
  plotGBM();
});

// Button to toggle scale
toggleScaleBtn.addEventListener('click', toggleScale);

// Initial plot
plotGBM();
</script>
</body>
</html>
